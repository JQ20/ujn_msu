<!DOCTYPE html>
<html lang="zh">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    

    <title>济南大学MSU</title>

    <!-- Bootstrap Core CSS -->
    <link href="__PUBLIC__/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="__PUBLIC__/css/sb-admin.css" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="__PUBLIC__/css/plugins/morris.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="__PUBLIC__/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="__MODULE__/Weihu/weihu_list">济南大学MSU</a>
            </div>
            <!-- Top Menu Items -->
            <ul class="nav navbar-right top-nav">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-user"></i>  <{$Think.session.name}> <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a id="updatePassword" href="JavaScript:void(0)"><i class="fa fa-fw fa-gear"></i>修改密码</a>
                        </li>

                        <li class="divider"></li>
                        <li>
                            <a href="__MODULE__/login/loginout"><i class="fa fa-fw fa-power-off"></i> 注销</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <div class="modal fade" id="updatePasswordModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">修改密码</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="form-group">
                                    <label class="form-control-label">输入原密码</label>
                                    <input type="password" class="form-control" id="currPassword" autocomplete="off">
                                    <input type="text" class="form-control hide" id="uid" autocomplete="off" value="<{$Think.session.uid}>">

                                </div>
                                <div class="form-group" >
                                    <label class="form-control-label" >输入新密码</label>
                                    <input type="password" class="form-control" id="newPassword" autocomplete="off">
                                </div>
                                <div class="form-group">
                                    <label class="form-control-label">再次输入新密码</label>
                                    <input type="password" class="form-control" id="confirm" autocomplete="off">
                                    <div class="alert alert-danger hide" id="errMsg">两次输入密码不一致</div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="updatePasswordBtn">修改</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
            <div class="collapse navbar-collapse navbar-ex1-collapse" >
                <ul class="nav navbar-nav side-nav" style="background: #EEEEEE">
                    <li>
                        <a href="__MODULE__/weihu/weihu_list"><i class="fa fa-fw fa-wrench"></i> 维护工作记录</a>
                            <ul>
                                <li>
                                    <a href="__MODULE__/weihu/weihu_add">增加维护记录</a>
                                </li>
                                <li>
                                    <a href="__MODULE__/weihu/weihu_list">查询未完成记录</a>
                                </li>
                                <li>
                                    <a href="__MODULE__/weihu/weihu_list_yes">查询已完成记录</a>
                                </li>
                            </ul>
                    </li>
                    <li>
                        <a href="__MODULE__/count"><i class="fa fa-fw fa-bar-chart-o"></i> 工作量统计</a>
                    </li>
                    <li>
                        <a href="__MODULE__/sign"><i class="fa fa-fw fa-tag"></i> 值班签到</a>
                    </li>
                    <if condition=" $Think.session.gid eq '超级管理员' ">
                        <li>
                            <a href="__MODULE__/user"><i class="fa fa-fw fa-users"></i> MSU用户管理</a>
                        </li>
                        <li>
                            <a href="__MODULE__/Ip/root_display"><i class="fa fa-fw fa-paper-plane"></i> IP段分配</a>
                        </li>
                        <li>
                            <a href="__MODULE__/web/web_list"><i class="fa fa-fw fa-money"></i> 网站缴费管理</a>
                        </li>
                        <li>
                            <a href="__MODULE__/admin"><i class="fa fa-fw fa-info"></i> 信息管理</a>
                        </li>
                    <elseif condition=" $Think.session.gid eq '缴费管理员' " />
                        <li>
                            <a href="__MODULE__/Ip/root_display"><i class="fa fa-fw fa-paper-plane"></i> IP段分配</a>
                        </li>
                        <li>
                            <a href="__MODULE__/web/web_list"><i class="fa fa-fw fa-money"></i> 网站缴费管理</a>
                        </li>
                    </if>
                   <!--  <li>
                        <a href="__MODULE__/msu"><i class="fa fa-fw fa-bar-chart-o"></i> 校园用户管理</a>
                            <ul>
                                <li>
                                    <a href="__MODULE__/msu/add_client_view">添加校园网用户</a>
                                </li>
                                <li>
                                    <a href="__MODULE__/msu/search_client_view">查询校园网用户</a>
                                </li>
                                <li>
                                    <a href="__MODULE__/msu/search_service_view">查询校园网服务</a>
                                </li>
                                <li>
                                    <a href="__MODULE__/msu/wege_payment">查询工资代扣用户</a>
                                </li>
                                <li>
                                    <a href="__MODULE__/msu/transform">用户缴费转移</a>
                                </li>
                            </ul>
                    </li> -->
                </ul>
            </div>
        </nav>

<!--警告：特殊情况，此处标签不应闭合！-->
<script type="text/javascript" src="__PUBLIC__/js/jquery.js"></script>
<script  type="text/javascript">
//    调用修改密码模态框
$(function () {
    var $updatePasswordBtn = $("#updatePassword");
    var $modal = $("#updatePasswordModal");
    $updatePasswordBtn.on('click', function(){
        $modal.modal({backdrop:false});

    });
});
$(function () {
    var $updatePasswordBtn = $('#updatePasswordBtn');

    var $currPassword = $('#currPassword');
    var $newPassword = $('#newPassword');
    var $confirm = $('#confirm');
    var $uid = $('#uid');

    var $errMsg = $('#errMsg');
    var showMsg = function(msg){
        $errMsg.text(msg);
        $errMsg.attr("class","alert-danger");
    };

    var clearInput = function(node){
        if("" !== node.find("input").val()){

            node.find("input").val("");
        }

    };

    var hideMsg = function (errMsg) {
        errMsg.attr("class","hide");
    };
    $updatePasswordBtn.on('click',function () {
        hideMsg($errMsg);
        if ($confirm.val() !== $newPassword.val()){
            showMsg('两次输入密码不一致');
        }else if($confirm.val() === ""){
            showMsg('密码不能为空');
        }else{
                var $data = {
                    "uid" : $uid.val(),
                    "currPass": $currPassword.val(),
                    "newPass": $newPassword.val()
                };
                $.ajax({
                type: "GET",
                url:'__MODULE__/user/updatePassword',
                data: $data,
                dataType:"json",
                success:function (data) {
                    if(0 === data.status) {
                        showMsg(data.info);
                    }else {
                        alert("密码修改成功");
                        $('#updatePasswordModal').modal('hide');

                    }
                }

            })
        }
        clearInput($('#updatePasswordModal'));

    });

})

</script>